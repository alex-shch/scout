<!DOCTYPE html>
<html>
	<head lang="en">
		<meta charset="UTF-8">
		<title></title>

		<script src="/js/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="></script>
	    <script src="/js/socket.io-1.4.5.js"></script>
	    <script src="/js/phaser.min-2.8.0.js"></script>

		<script>
			$(document).ready(function() {
				// --- logging -----------------------------------------------
				var command = $("#command");
				var logData = []
				var logView = $("#logView");

				log = function(msg) {
					if (logData.length == 50) {
						logData.shift()
					}
					logData.push(msg)
					logView.val(logData.join('\n'));
				}

				// --- socket.io ---------------------------------------------
				var socket = io.connect(window.location.host, {path: "/ws/", transports: ['websocket']});
				socket.on('tick', function(msg){
			 		log("tick " + msg);
				});

				socket.on('playerAdded', function(msg){
			 		console.log("player added, id: " + msg);
				});

				socket.on('playerRemoved', function(msg){
			 		console.log("player removed, id: " + msg);
				});


				$("#sendCommandButton").click(function(){
					log("send data")
				});

				// --- phaser ------------------------------------------------
				var game = new Phaser.Game(
					800, 600,
					Phaser.AUTO,
					'gameView',
					{ preload: preload, create: create, update: update, render: render }
				);

				function preload() {
					game.load.image('sky', 'assets/sky.png');
					game.load.image('ground', 'assets/platform.png');
					game.load.image('star', 'assets/star.png');
					game.load.spritesheet('dude', 'assets/dude.png', 32, 48);
				}

				var star

				function create() {
					//  A simple background for our game
				    game.add.sprite(0, 0, 'sky');

					star = game.add.sprite(0, 0, 'star');
					star.anchor.set(0.5)

					game.input.onDown.add(doSomething, this);
				}

				function doSomething(pointer) {
					 // pointer will contain the pointer that activated this event
					console.log('move')
					msg = {
						x: pointer.x,
						y: pointer.y
					}
					socket.emit("move", JSON.stringify(msg))
				}

				function update() {
				}

				function render() {
					game.debug.cameraInfo(game.camera, 8, 16);
				}
			});
		</script>
	</head>
	<body>
		<table>
			<tr>
				<td><div id="gameView"></div></td>
				<td valign="top">
					<input type="text" id="command" name="command" value="">
					<button id="sendCommandButton">Send</button>
					<br>
					<textarea id="logView" rows="10" cols="50" style="height: 500px"></textarea>
				</td>
			</tr>
		</table>
	</body>
</html>
