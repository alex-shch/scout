<!DOCTYPE html>
<html>
	<head lang="en">
		<meta charset="UTF-8">
		<title></title>

		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<script>
			$( document ).ready(function() {
				var conn;
				var command = $("#command");
				var logData = []
				var log = $("#log");

				// var name = window.prompt("Your name");

				// exchange
				if (window["WebSocket"]) {
					//conn = new WebSocket("ws://localhost:8080/ws?name=" + name);
					conn = new WebSocket("ws://localhost:8080/ws");
					conn.onopen = function() {
					    console.log("Connected");
					};
					conn.onclose = function(evt) {
					    console.log("Connection closed");
					};
					conn.onmessage = function(evt) {
						if (logData.length == 10)
							logData.shift()
						logData.push(evt.data)

					    //log.val(log.val() + '\n' + evt.data);
						log.val(logData.join('\n'));
				    }
				} else {
					window.alert("Sorry, your device does not supported");
				}

				$("#send_command").click(function(){

					conn.send(command.val());
					command.val("");
				});



				// phaser
				var game = new Phaser.Game(800, 600, Phaser.AUTO, 'gameView', { preload: preload, create: create, update: update });

				function preload() {
					game.load.image('sky', 'assets/sky.png');
					game.load.image('ground', 'assets/platform.png');
					game.load.image('star', 'assets/star.png');
					game.load.spritesheet('dude', 'assets/dude.png', 32, 48);
				}

				var star

				function create() {
					//  A simple background for our game
				    game.add.sprite(0, 0, 'sky');

					star = game.add.sprite(0, 0, 'star');
					star.anchor.set(0.5)

					game.input.onDown.add(doSomething, this);
				}

				function doSomething(pointer) {
					 // pointer will contain the pointer that activated this event
					console.log('click')
					msg = {
						name: 'click',
						x: pointer.x,
						y: pointer.y
					}
					conn.send(JSON.stringify(msg))
				}

				function update() {
				}

			});
		</script>

		<script type="text/javascript" src="js/phaser.min.js"></script>
	</head>
	<body>
		<div id="gameView"></div>
		<input type="text" id="command" name="command" value="">
		<button id="send_command">Send</button>
		<br/>

		<textarea id="log" rows="10" cols="50"></textarea>

	</body>
</html>
